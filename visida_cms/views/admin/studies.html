<div class="container" ng-controller="adminController">
    <div class="row content">
        <div class="col-xs-12 page-head">
            <span class="">Studies</span>
            <span class="pull-right" ng-show="!userLoading && timeTakenStudies" style="font-size: x-small; margin-top: 20px;">loaded in {{timeTakenStudies}}ms</span>
            <span class="glyphicon glyphicon-plus glyph-md pull-right" role="button" ng-click="createStudy()" style="padding-left: 10px;" title="Create"></span>
            <span class="glyphicon glyphicon-refresh glyph-md pull-right {{ (userLoading) && 'loading-run' || 'loading-done' }}"></span>
            <hr class="head-hr">
        </div>
        <div class="col-xs-12" style="display: table;">

            <label for="search" style="display: table-cell; width: 1px; padding-left: 17px">Search:</label>
            <div style="display: table-cell; padding-right: 30px;">
                <input type="text" name="search" ng-change="updateStudySearch(search)" ng-model="search" class="form-control" style="" placeholder="">
            </div>
            <!-- <span class="glyphicon btn-glyph glyphicon-home" role="button" title="Filter by household" style="color: #337ab7; display: table-cell; width: 1px; font-size: 22px; padding-right: 6px; vertical-align: middle;" ng-click="addFilterHH()"></span>
               <span class="glyphicon btn-glyph glyphicon-user" role="button" title="Filter by user" style="color: #337ab7; display: table-cell; width: 1px; font-size: 22px; padding-right: 20px; vertical-align: middle;" ng-click="addFilterUser()"></span>
            -->
            <!-- <div style="display: table-cell; width: 1px; padding-right: 30px;">
            </div> -->
            <!-- <input type="text" name="search" ng-change="updateStudySearch(search)" ng-model="search" class="form-control" style="display: table-cell; width: 94%;" placeholder="search user:name hh:household"> -->
        </div>
        <div class="col-xs-12" style="margin-top:15px; text-align: center">
            <div style="display: inline-block; width: 20px; height: 20px; background-color: #5cb85c;"></div>
            <div style="display: inline-block; padding-right:15px;">Completed</div>
            <div style="display: inline-block; width: 20px; height: 20px; background-color: #f0ad4e;"></div>
            <div style="display: inline-block; padding-right:15px;">In Progress</div>
            <div style="display: inline-block; width: 20px; height: 20px; background-color: #d9534f;"></div>
            <div style="display: inline-block;">Not Started</div>
        </div>
        <div class="col-xs-12" style="margin-top:15px; text-align: center;">
            <div style="display: inline-block;">Sort by name: </div>
            <span class="glyphicon glyphicon-sort" style="color: #517329; font-size: 14px;" role="button" ng-click="sortStudies(0)" />
            <div style="display: inline-block; padding-left:15px;">Sort by date created: </div>
            <span class="glyphicon glyphicon-sort" style="color: #517329; font-size: 14px;" role="button" ng-click="sortStudies(1)" />
        </div>
        <small class="text-danger">{{ studyError }}</small>
        <div class="col-xs-12">
            <div class="row bordered-container" style="border-width: 2px; padding-bottom: 0px;" ng-repeat="study in studies" ng-show="!study.hidden">
                <div class="col-sm-2" style="padding-left: 5px; padding-right: 5px;">
                    <a href="#!/admin/study?id={{ study.id }}" style="font-size: 1.2em; font-weight: 700;">{{ study.name }}</a><br />
                    <span>{{ study.foodCompositionTable.name }}</span><br />
                    <span ng-if="study.gestalt" style="font-style: italic;">Gestalt</span>
                </div>
                <div class="col-sm-8" style="padding: 10px; padding-left: 40px; padding-right: 40px;">
                    <table style="border-collapse: collapse; ">
                        <tr>
                            <td style="width: 1px">
                                <span class="row-head">Progress: </span>
                            </td>
                            <td style="width: 100%; padding-left: 10px;">
                                <div class="progress hoverimage" style="width: 100%; overflow: visible;">
                                    <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:{{ 100 * (study.progress.identifyCompleted / study.progress.recordTotal) }}%">
                                    </div>
                                    <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:{{ 100 * (study.progress.identifyInProgress / study.progress.recordTotal) }}%">
                                    </div>
                                    <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:{{ (study.progress.recordTotal === 0) ? 100 : 100 * (study.progress.recordNotStarted / study.progress.recordTotal) }}%">
                                    </div>
                                    <p class="hoverimagetext" style="float: left; margin-top: -3px">Completed: {{ study.progress.recordTotal === 0 ? 0 : roundPercentage(100 * (study.progress.identifyCompleted / study.progress.recordTotal)) }}% | In Progress: {{  (study.progress.recordTotal === 0) ? 0 : roundPercentage(100 * (study.progress.identifyInProgress / study.progress.recordTotal)) }}% | Not Started: {{  (study.progress.recordTotal === 0) ? 0 : roundPercentage(100 * (study.progress.recordNotStarted / study.progress.recordTotal))}}%</p>
                                </div>
                            </td>
                        </tr>
                        <!-- <tr>
                            <td style="width: 1px">
                                <span class="row-head">Quantification: </span>
                            </td>
                            <td style="width: 100%; padding-left: 10px;">
                                <div class="progress hoverimage" style="width: 100%; overflow: visible;">
                                    <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:{{ 100 * (study.progress.portionCompleted / study.progress.recordTotal) }}%">
                                    </div>
                                    <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:{{ 100 * (study.progress.portionInProgress / study.progress.recordTotal) }}%">
                                    </div>
                                    <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:{{  (study.progress.recordTotal === 0) ? 100 : 100 * (study.progress.recordNotStarted / study.progress.recordTotal) }}%">
                                    </div>
                                    <p class="hoverimagetext" style="float: left; margin-top: -3px">Completed: {{  (study.progress.recordTotal === 0) ? 0 : roundPercentage(100 * (study.progress.portionCompleted / study.progress.recordTotal)) }}% | In Progress: {{  (study.progress.recordTotal === 0) ? 0 : roundPercentage(100 * (study.progress.portionInProgress / study.progress.recordTotal)) }}% | Not Started: {{  (study.progress.recordTotal === 0) ? 0 : roundPercentage(100 * (study.progress.recordNotStarted / study.progress.recordTotal))}}%</p>
                                </div>
                            </td>
                        </tr> -->
                    </table>
                </div>
                <div class="col-sm-2" style="padding-left: 5px; padding-right: 5px;">
                    <span class="bolder">Analysts</span>
                    <ul ng-if="!study.analystsExpanded">
                        <li ng-repeat="analyst in study.analysts | limitTo:5"><span>{{ analyst.userName }}</span></li>
                        <li ng-if="study.analysts.length > 5"><span ng-click="study.analystsExpanded=true" style="cursor:pointer; font-style:italic;">show more...</span></li>
                    </ul>
                    <ul ng-if="study.analystsExpanded">
                        <li ng-repeat="analyst in study.analysts"><span>{{ analyst.userName }}</span></li>
                        <li ng-if="study.analysts.length > 5"><span ng-click="study.analystsExpanded=false" style="cursor:pointer; font-style:italic;">show less...</span></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
